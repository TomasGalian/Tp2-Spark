{"cells":[{"cell_type":"markdown","metadata":{"id":"yci-EMhVx6d7"},"source":["Obtenga un vector que indique si una compañía trabajo/no trabajo en una película, para cada película. Para cada compañía utilice estos vectores para buscar cuál es la compañía más similar, utilizando la distancia coseno. Imprima toda la lista de tuplas (compañía, similar)"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"background_save":true,"base_uri":"https://localhost:8080/"},"id":"cxKiBw9D-OLV","outputId":"e929c37a-abd3-410e-c6bf-3b7adc6e70bc"},"outputs":[{"name":"stdout","output_type":"stream","text":["Looking in indexes: https://pypi.org/simple, https://us-python.pkg.dev/colab-wheels/public/simple/\n","Collecting pyspark\n","  Downloading pyspark-3.3.0.tar.gz (281.3 MB)\n","\u001b[K     |████████████████████████████████| 281.3 MB 38 kB/s \n","\u001b[?25hCollecting py4j==0.10.9.5\n","  Downloading py4j-0.10.9.5-py2.py3-none-any.whl (199 kB)\n","\u001b[K     |████████████████████████████████| 199 kB 47.7 MB/s \n","\u001b[?25hBuilding wheels for collected packages: pyspark\n","  Building wheel for pyspark (setup.py) ... \u001b[?25l\u001b[?25hdone\n","  Created wheel for pyspark: filename=pyspark-3.3.0-py2.py3-none-any.whl size=281764026 sha256=aa3330ed492f61c46c18eb12b7b1536816bf4c28f5ea4f5ae5f02073921e5049\n","  Stored in directory: /root/.cache/pip/wheels/7a/8e/1b/f73a52650d2e5f337708d9f6a1750d451a7349a867f928b885\n","Successfully built pyspark\n","Installing collected packages: py4j, pyspark\n","Successfully installed py4j-0.10.9.5 pyspark-3.3.0\n"]}],"source":["#Realizamos las importanciones\n","!pip install pyspark"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"background_save":true},"id":"YHU6_MhL-phX"},"outputs":[],"source":["#Realizamos las importaciones para usar google drive y pyspark\n","from pydrive.auth import GoogleAuth\n","from pydrive.drive import GoogleDrive\n","from google.colab import auth\n","from oauth2client.client import GoogleCredentials\n","from pyspark.sql import *\n","from pyspark.sql.functions import *\n","from pyspark import SparkContext\n","from pyspark.sql import SQLContext\n","import pandas as pd"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"DtAZO599-qXv"},"outputs":[],"source":["auth.authenticate_user()\n","gauth = GoogleAuth()\n","gauth.credentials = GoogleCredentials.get_application_default()\n","drive = GoogleDrive(gauth)"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"RmVXC0LQ-rLF"},"outputs":[],"source":["#Descargamos movies.parquet\n","descarga = drive.CreateFile({'id':'1YKh46_KdgSC-6UZ0mttbOqVI6tXgly-F'})\n","descarga.GetContentFile('movies.parquet')"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"SS8AgRpK-yDO"},"outputs":[],"source":["spark = SparkSession.builder.getOrCreate() #Obtenemos una sesion de spark\n","sc = spark.sparkContext #Obtenemos el contexto"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"LNVDhMoF-zSd"},"outputs":[],"source":["#Creo los rdd con los que voy a trabajar\n","sqlContext = SQLContext(sc)\n","df = sqlContext.read.parquet('movies.parquet',header=True,inferSchema=True) \n","moviesRdd = df.rdd "]},{"cell_type":"code","execution_count":null,"metadata":{"id":"hd-b644RhqSf"},"outputs":[],"source":["moviesRdd.count()"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":2985,"status":"ok","timestamp":1665244091689,"user":{"displayName":"Tomas Ezequiel Galian","userId":"10920691488309285943"},"user_tz":180},"id":"9F5ZDCo0Zpsl","outputId":"0f04a501-f6cb-4c81-d28c-23e1be1e9f5b"},"outputs":[{"data":{"text/plain":["33585"]},"execution_count":9,"metadata":{},"output_type":"execute_result"}],"source":["#Filtro aquellas peliculas que no tengan asociada una compañia. Luego mapeo de forma que me quede \n","moviesRdd = moviesRdd.filter(lambda x: x.production_companies != None)\n","moviesRdd.count()"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":5216,"status":"ok","timestamp":1665249063111,"user":{"displayName":"Tomas Ezequiel Galian","userId":"10920691488309285943"},"user_tz":180},"id":"uQcy4MGI206-","outputId":"e9bab41a-4db8-4c6f-db12-f8e7819e3831"},"outputs":[{"data":{"text/plain":["[('2550', {'6795', '8844'}),\n"," ('10201',\n","  {'10029',\n","   '10342',\n","   '11082',\n","   '11087',\n","   '11112',\n","   '11511',\n","   '11630',\n","   '12154',\n","   '14052',\n","   '15771',\n","   '161495',\n","   '16562',\n","   '16889',\n","   '1727',\n","   '19124',\n","   '20242',\n","   '2054',\n","   '2348',\n","   '27281',\n","   '2787',\n","   '27969',\n","   '32144',\n","   '41374',\n","   '423',\n","   '43634',\n","   '45096',\n","   '46029',\n","   '46094',\n","   '47898',\n","   '4806',\n","   '68430',\n","   '79593',\n","   '85411',\n","   '8844',\n","   '9057',\n","   '9092'})]"]},"execution_count":10,"metadata":{},"output_type":"execute_result"}],"source":["#Lo primero que hago es realizar un flat map de forma tal que me quede cada registro de la forma (idCompania,idMovie) de forma tal que si una pelicula fue hecha por varias compañias quede separada.\n","#Luego realizo un reduceByKey juntando para cada compañia todas las peliculas que hizo quedando (idCompania,listaIdMovie)\n","#Por ultimo realizo un map para que esa lista de movies que tenemos se transforme en un set.\n","moviesCompaniesRdd = moviesRdd.flatMap(lambda x: [(w,x.id) for w in x.production_companies.split(',')]).reduceByKey(lambda a,b: a+','+b)\\\n",".map(lambda x: (x[0],set(x[1].split(','))))\n","moviesCompaniesRdd.take(2)"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":606,"status":"ok","timestamp":1665249092783,"user":{"displayName":"Tomas Ezequiel Galian","userId":"10920691488309285943"},"user_tz":180},"id":"aVSYU8af3G0b","outputId":"1ed28492-11b9-42d4-9fed-5b5a7c4c181d"},"outputs":[{"data":{"text/plain":["23692"]},"execution_count":11,"metadata":{},"output_type":"execute_result"}],"source":["moviesCompaniesRdd.count()"]},{"cell_type":"markdown","metadata":{"id":"m_sITs6RlHee"},"source":["Vemos que en total tenemos 23692 companias diferentes"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"oiPX9r2V25BT"},"outputs":[],"source":["#Lo que hago aca es hacer una especie de join consigo mismo con cartesian. Lo que hace es juntarme todas las combinaciones de registros de a pares.\n","#Es decir si yo tengo los siguientes registros: regA,regB,regC lo que hace es generarme los siguientes registros: (regA,regA),(regA,regB),(regA,regC),(regB,regA),(regB,regB),(regB,regC),(regC,regA),(regC,regB),(regC,regC)\n","#Con esto me ahorro hacer una doble iteracion en busca de ver que compañia es mas similar. \n","moviesCompaniesSimilaresRdd = moviesCompaniesRdd.cartesian(moviesCompaniesRdd)"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":49405,"status":"ok","timestamp":1665249532769,"user":{"displayName":"Tomas Ezequiel Galian","userId":"10920691488309285943"},"user_tz":180},"id":"-9_v1vIJ9UC6","outputId":"375b89da-520f-47cb-f437-9f4d407b6d33"},"outputs":[{"data":{"text/plain":["561310864"]},"execution_count":13,"metadata":{},"output_type":"execute_result"}],"source":["moviesCompaniesSimilaresRdd.count()"]},{"cell_type":"markdown","metadata":{"id":"nl4IvfdFmrEJ"},"source":["Ahora tengo 561310864 registros con todas las combinaciones posibles"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":672,"status":"ok","timestamp":1665249939210,"user":{"displayName":"Tomas Ezequiel Galian","userId":"10920691488309285943"},"user_tz":180},"id":"zIfCVFiBPNB6","outputId":"34f1d1d9-5a0b-4874-e52e-912a05a2e1ad"},"outputs":[{"data":{"text/plain":["(('2550', {'6795', '8844'}), ('2550', {'6795', '8844'}))"]},"execution_count":15,"metadata":{},"output_type":"execute_result"}],"source":["#Vemos como quedarian los registros formados. La forma es la siguiente ((idCompania,{idsMovies}),((idCompania,{idsMovies}))) donde las movies que acompañan a las companias son las movies que esas compañias producieron\n","moviesCompaniesSimilaresRdd.first()"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"bBR5zmeadqVQ"},"outputs":[],"source":["#Aca filtro el primer registro de cada compañia ya que es consigo mismo que se compara y no lo queremos asi que filtro aquellas que tengan el mismo idCompania.\n","#Luego realizo un map de forma tal que mis registros queden de la forma: (idCompania1,(moviesIdCompania1,(idCompania2,moviesIdCompania2)))\n","moviesCompaniesSimilaresRdd = moviesCompaniesSimilaresRdd.filter(lambda x: x[0][0]!=x[1][0]).map(lambda x: (x[0][0],(x[0][1],x[1])))"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":591,"status":"ok","timestamp":1665250030473,"user":{"displayName":"Tomas Ezequiel Galian","userId":"10920691488309285943"},"user_tz":180},"id":"7fPb5Ol5sVmn","outputId":"3d940f25-1ca4-454c-f6d1-5c8074dc9d80"},"outputs":[{"data":{"text/plain":["('2550',\n"," ({'6795', '8844'},\n","  ('10201',\n","   {'10029',\n","    '10342',\n","    '11082',\n","    '11087',\n","    '11112',\n","    '11511',\n","    '11630',\n","    '12154',\n","    '14052',\n","    '15771',\n","    '161495',\n","    '16562',\n","    '16889',\n","    '1727',\n","    '19124',\n","    '20242',\n","    '2054',\n","    '2348',\n","    '27281',\n","    '2787',\n","    '27969',\n","    '32144',\n","    '41374',\n","    '423',\n","    '43634',\n","    '45096',\n","    '46029',\n","    '46094',\n","    '47898',\n","    '4806',\n","    '68430',\n","    '79593',\n","    '85411',\n","    '8844',\n","    '9057',\n","    '9092'})))"]},"execution_count":18,"metadata":{},"output_type":"execute_result"}],"source":["moviesCompaniesSimilaresRdd.first()"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":1398147,"status":"ok","timestamp":1665254451576,"user":{"displayName":"Tomas Ezequiel Galian","userId":"10920691488309285943"},"user_tz":180},"id":"L0AA4BqS-HYR","outputId":"d35b1bc3-0a1d-4e23-b93e-8a9e830e6b69"},"outputs":[{"data":{"text/plain":["[('6194', '79'),\n"," ('19464', '19465'),\n"," ('508', '10104'),\n"," ('4', '2348'),\n"," ('258', '88533'),\n"," ('23770', '11647'),\n"," ('60', '7576'),\n"," ('56', '20448'),\n"," ('915', '1504'),\n"," ('1504', '915'),\n"," ('14723', '14159'),\n"," ('441', '9269'),\n"," ('10210', '1403'),\n"," ('216', '215'),\n"," ('15547', '60'),\n"," ('12', '1565'),\n"," ('590', '79439'),\n"," ('8170', '79439'),\n"," ('9335', '6639'),\n"," ('25129', '79439'),\n"," ('23647', '40669'),\n"," ('10103', '76083'),\n"," ('17031', '507'),\n"," ('10163', '694'),\n"," ('6130', '6129'),\n"," ('34237', '871'),\n"," ('4174', '12314'),\n"," ('2480', '14485'),\n"," ('361', '9168'),\n"," ('7832', '21631'),\n"," ('36390', '32184'),\n"," ('38003', '36390'),\n"," ('82', '22370'),\n"," ('5841', '17225'),\n"," ('83201', '93174'),\n"," ('38196', '38197'),\n"," ('16366', '5869'),\n"," ('12911', '12912'),\n"," ('7965', '20377'),\n"," ('46059', '46060'),\n"," ('2521', '3054'),\n"," ('806', '2743'),\n"," ('12745', '927'),\n"," ('17027', '11745'),\n"," ('38673', '85045'),\n"," ('38674', '85045'),\n"," ('40534', '85045'),\n"," ('83', '11795'),\n"," ('883', '63893'),\n"," ('3236', '3387'),\n"," ('93488', '93489'),\n"," ('94477', '38778'),\n"," ('94478', '38778'),\n"," ('3906', '65273'),\n"," ('18902', '2765'),\n"," ('20740', '60357'),\n"," ('644', '508'),\n"," ('13190', '13187'),\n"," ('7828', '35859'),\n"," ('9255', '17781'),\n"," ('28205', '14925'),\n"," ('38692', '39861'),\n"," ('39861', '38692'),\n"," ('705', '33027'),\n"," ('1147', '17873'),\n"," ('17825', '3890'),\n"," ('2851', '36859'),\n"," ('16192', '396'),\n"," ('4127', '23808'),\n"," ('23808', '37350'),\n"," ('70', '70940'),\n"," ('5528', '10565'),\n"," ('25345', '85049'),\n"," ('2630', '60546'),\n"," ('2370', '75053'),\n"," ('414', '50830'),\n"," ('36854', '414'),\n"," ('9209', '1610'),\n"," ('348', '1656'),\n"," ('285', '12451'),\n"," ('42935', '7260'),\n"," ('2154', '28206'),\n"," ('37580', '82513'),\n"," ('8923', '18495'),\n"," ('24946', '9154'),\n"," ('29272', '29273'),\n"," ('2596', '86565'),\n"," ('11134', '11409'),\n"," ('78701', '88753'),\n"," ('10015', '65604'),\n"," ('4734', '4733'),\n"," ('25299', '1078'),\n"," ('37350', '73997'),\n"," ('4908', '58260'),\n"," ('36024', '7035'),\n"," ('39250', '11840'),\n"," ('6455', '4030'),\n"," ('16823', '644'),\n"," ('1353', '36207'),\n"," ('37294', '37295'),\n"," ('552', '86565'),\n"," ('278', '1382'),\n"," ('496', '662'),\n"," ('6216', '94951'),\n"," ('33419', '31080'),\n"," ('14280', '14281'),\n"," ('38179', '38289'),\n"," ('38289', '38179'),\n"," ('38276', '3268'),\n"," ('21222', '88753'),\n"," ('82606', '82607'),\n"," ('82607', '82606'),\n"," ('89311', '306'),\n"," ('16737', '8'),\n"," ('79561', '79560'),\n"," ('10098', '10099'),\n"," ('10099', '10098'),\n"," ('23246', '5350'),\n"," ('45728', '45729'),\n"," ('36863', '36865'),\n"," ('36865', '36864'),\n"," ('6556', '2092'),\n"," ('14668', '13139'),\n"," ('4972', '1280'),\n"," ('36907', '31080'),\n"," ('75712', '75713'),\n"," ('36789', '36790'),\n"," ('249', '25807'),\n"," ('37265', '644'),\n"," ('17411', '37260'),\n"," ('408', '272'),\n"," ('5798', '8326'),\n"," ('5778', '71357'),\n"," ('157', '7678'),\n"," ('55151', '55150'),\n"," ('9364', '11913'),\n"," ('37354', '37353'),\n"," ('477', '3592'),\n"," ('61409', '1280'),\n"," ('6125', '22135'),\n"," ('10282', '82572'),\n"," ('5551', '37065'),\n"," ('81131', '10103'),\n"," ('4952', '36555'),\n"," ('356', '23441'),\n"," ('75424', '2464'),\n"," ('38091', '6032'),\n"," ('315', '75413'),\n"," ('744', '21645'),\n"," ('982', '984'),\n"," ('20777', '57176'),\n"," ('80481', '101'),\n"," ('44', '28121'),\n"," ('7325', '7327'),\n"," ('7326', '7327'),\n"," ('38178', '60546'),\n"," ('26424', '88753'),\n"," ('1216', '70935'),\n"," ('46654', '54659'),\n"," ('875', '16772'),\n"," ('16772', '29658'),\n"," ('5982', '13060'),\n"," ('38955', '8331'),\n"," ('452', '453'),\n"," ('55140', '306'),\n"," ('27128', '38664'),\n"," ('16804', '14026'),\n"," ('3541', '64448'),\n"," ('6137', '6136'),\n"," ('11011', '20418'),\n"," ('13837', '86308'),\n"," ('12657', '21503'),\n"," ('12451', '44419'),\n"," ('88', '11272'),\n"," ('6697', '6700'),\n"," ('36995', '14'),\n"," ('21454', '80352'),\n"," ('1704', '2328'),\n"," ('17179', '29646'),\n"," ('86296', '16975'),\n"," ('72598', '93632'),\n"," ('1152', '21074'),\n"," ('21075', '21074'),\n"," ('21076', '21074'),\n"," ('11561', '14698'),\n"," ('87554', '97'),\n"," ('1655', '74793'),\n"," ('328', '402'),\n"," ('26192', '24827'),\n"," ('20004', '8601'),\n"," ('2756', '2854'),\n"," ('4641', '10652'),\n"," ('37163', '7832'),\n"," ('657', '4650'),\n"," ('762', '4650'),\n"," ('4650', '657'),\n"," ('1460', '8411'),\n"," ('31892', '8411'),\n"," ('385', '195'),\n"," ('4928', '15957'),\n"," ('14121', '14122'),\n"," ('22060', '88753'),\n"," ('21155', '21154'),\n"," ('608', '36357'),\n"," ('656', '5309'),\n"," ('44774', '88753'),\n"," ('8830', '11085'),\n"," ('5570', '75351'),\n"," ('21920', '2980'),\n"," ('240', '14604'),\n"," ('2833', '8824'),\n"," ('13534', '36959'),\n"," ('3475', '40148'),\n"," ('11707', '14225'),\n"," ('3434', '4'),\n"," ('13954', '29119'),\n"," ('58752', '20076'),\n"," ('8846', '8844'),\n"," ('1648', '59646'),\n"," ('1202', '8876'),\n"," ('8876', '1202'),\n"," ('7901', '37292'),\n"," ('8453', '21990'),\n"," ('10257', '10258'),\n"," ('502', '504'),\n"," ('79619', '79620'),\n"," ('79621', '79620'),\n"," ('464', '11372'),\n"," ('465', '463'),\n"," ('1373', '5503'),\n"," ('56302', '56303'),\n"," ('56303', '56302'),\n"," ('11143', '6584'),\n"," ('8739', '8738'),\n"," ('36079', '37018'),\n"," ('185', '5367'),\n"," ('3554', '26812'),\n"," ('5229', '6194'),\n"," ('4927', '74288'),\n"," ('12838', '59352'),\n"," ('53', '15749'),\n"," ('10209', '88753'),\n"," ('2241', '2238'),\n"," ('25023', '84953'),\n"," ('611', '60530'),\n"," ('17087', '94199'),\n"," ('40605', '78061'),\n"," ('2081', '90117'),\n"," ('62139', '2081'),\n"," ('2188', '24076'),\n"," ('286', '60'),\n"," ('1153', '90896'),\n"," ('42498', '7508'),\n"," ('146', '68743'),\n"," ('10212', '60'),\n"," ('11356', '12612'),\n"," ('659', '660'),\n"," ('3618', '8252'),\n"," ('536', '14120'),\n"," ('209', '11344'),\n"," ('11344', '209'),\n"," ('10492', '17095'),\n"," ('9387', '54425'),\n"," ('3902', '18775'),\n"," ('11043', '95355'),\n"," ('11272', '88'),\n"," ('90897', '90896'),\n"," ('43854', '27644'),\n"," ('47380', '3102'),\n"," ('538', '1555'),\n"," ('623', '60'),\n"," ('20448', '6422'),\n"," ('10170', '20607'),\n"," ('16645', '16644'),\n"," ('503', '47933'),\n"," ('11494', '11493'),\n"," ('8834', '500'),\n"," ('7931', '17624'),\n"," ('1448', '77949'),\n"," ('8366', '36229'),\n"," ('84937', '35872'),\n"," ('75480', '10308'),\n"," ('9266', '20227'),\n"," ('10000', '1714'),\n"," ('52760', '77507'),\n"," ('4847', '29812'),\n"," ('11390', '88753'),\n"," ('1531', '44438'),\n"," ('1243', '86893'),\n"," ('15316', '75566'),\n"," ('79415', '4904'),\n"," ('16774', '57088'),\n"," ('10531', '15395'),\n"," ('57288', '10927'),\n"," ('1560', '7'),\n"," ('38664', '27128'),\n"," ('1083', '13965'),\n"," ('8841', '8842'),\n"," ('6824', '6825'),\n"," ('6235', '66633'),\n"," ('10316', '23116'),\n"," ('25687', '25686'),\n"," ('3581', '41'),\n"," ('5368', '55798'),\n"," ('2705', '68247'),\n"," ('68248', '80298'),\n"," ('40668', '40669'),\n"," ('52741', '3989'),\n"," ('38782', '38783'),\n"," ('38663', '38662'),\n"," ('19507', '50796'),\n"," ('3187', '88753'),\n"," ('720', '821'),\n"," ('6255', '5061'),\n"," ('78338', '78339'),\n"," ('4506', '23143'),\n"," ('4508', '12021'),\n"," ('52513', '52515'),\n"," ('52514', '52515'),\n"," ('52860', '2499'),\n"," ('79654', '88753'),\n"," ('458', '456'),\n"," ('25358', '38005'),\n"," ('49325', '85425'),\n"," ('43910', '6194'),\n"," ('248', '939'),\n"," ('2484', '552'),\n"," ('1693', '81127'),\n"," ('75348', '1274'),\n"," ('3713', '3712'),\n"," ('820', '88753'),\n"," ('40544', '40543'),\n"," ('840', '19105'),\n"," ('23434', '559'),\n"," ('44419', '12451'),\n"," ('763', '19116'),\n"," ('54502', '60600'),\n"," ('1257', '88753'),\n"," ('40739', '40740'),\n"," ('8335', '15102'),\n"," ('1601', '85'),\n"," ('27085', '27084'),\n"," ('39602', '4063'),\n"," ('2511', '94818'),\n"," ('20521', '982'),\n"," ('31059', '75225'),\n"," ('4158', '4157'),\n"," ('40675', '40674'),\n"," ('8213', '3462'),\n"," ('41052', '38567'),\n"," ('91005', '1382'),\n"," ('19902', '19905'),\n"," ('16280', '65515'),\n"," ('21716', '21717'),\n"," ('65515', '65514'),\n"," ('3259', '938'),\n"," ('10566', '60294'),\n"," ('39288', '16978'),\n"," ('16718', '40648'),\n"," ('162', '1964'),\n"," ('23912', '23913'),\n"," ('25680', '25679'),\n"," ('29692', '88753'),\n"," ('40460', '88753'),\n"," ('21872', '21871'),\n"," ('8808', '22040'),\n"," ('16232', '74363'),\n"," ('11533', '33808'),\n"," ('33333', '29729'),\n"," ('5488', '225'),\n"," ('4006', '83409'),\n"," ('30724', '60'),\n"," ('8770', '7049'),\n"," ('473', '474'),\n"," ('6174', '441'),\n"," ('11463', '11084'),\n"," ('24931', '67867'),\n"," ('93280', '4'),\n"," ('542', '543'),\n"," ('15493', '15494'),\n"," ('61660', '16953'),\n"," ('48184', '6194'),\n"," ('12372', '80588'),\n"," ('21143', '7981'),\n"," ('11670', '22297'),\n"," ('8330', '718'),\n"," ('7448', '1586'),\n"," ('18094', '88753'),\n"," ('4991', '4990'),\n"," ('960', '959'),\n"," ('1951', '33'),\n"," ('3826', '4248'),\n"," ('9998', '86084'),\n"," ('6562', '14281'),\n"," ('52197', '12591'),\n"," ('1683', '21911'),\n"," ('25766', '25765'),\n"," ('12943', '14840'),\n"," ('18170', '18171'),\n"," ('32178', '90400'),\n"," ('90512', '90400'),\n"," ('10215', '10214'),\n"," ('69888', '69889'),\n"," ('6313', '6314'),\n"," ('10324', '4'),\n"," ('14591', '25321'),\n"," ('27584', '40956'),\n"," ('40955', '40956'),\n"," ('147', '23303'),\n"," ('20743', '1'),\n"," ('14701', '88753'),\n"," ('21953', '21954'),\n"," ('22207', '22211'),\n"," ('3631', '55777'),\n"," ('11601', '89445'),\n"," ('15868', '1701'),\n"," ('2124', '8829'),\n"," ('2347', '8411'),\n"," ('333', '26281'),\n"," ('2141', '2142'),\n"," ('40244', '925'),\n"," ('520', '521'),\n"," ('56396', '1596'),\n"," ('419', '32336'),\n"," ('89304', '89303'),\n"," ('3391', '39825'),\n"," ('1163', '50482'),\n"," ('10697', '14555'),\n"," ('14555', '10697'),\n"," ('23893', '23894'),\n"," ('13769', '14358'),\n"," ('3981', '88753'),\n"," ('36638', '2380'),\n"," ('6781', '65270'),\n"," ('7380', '20377'),\n"," ('46976', '882'),\n"," ('8818', '93522'),\n"," ('12958', '559'),\n"," ('81127', '1693'),\n"," ('3089', '41'),\n"," ('3230', '3201'),\n"," ('1281', '16136'),\n"," ('93549', '23708'),\n"," ('4189', '58583'),\n"," ('1197', '12'),\n"," ('8369', '22505'),\n"," ('27013', '27014'),\n"," ('47818', '11493'),\n"," ('3805', '3807'),\n"," ('3807', '3806'),\n"," ('25960', '17763'),\n"," ('3058', '67035'),\n"," ('7458', '306'),\n"," ('44460', '88753'),\n"," ('18339', '35'),\n"," ('3264', '4'),\n"," ('1830', '14554'),\n"," ('22542', '306'),\n"," ('11773', '15893'),\n"," ('44822', '44821'),\n"," ('2229', '60'),\n"," ('23843', '8411'),\n"," ('4107', '6575'),\n"," ('372', '13158'),\n"," ('1783', '1757'),\n"," ('30225', '11943'),\n"," ('19813', '10222'),\n"," ('22289', '78182'),\n"," ('15469', '88753'),\n"," ('11465', '88753'),\n"," ('778', '779'),\n"," ('779', '778'),\n"," ('588', '29133'),\n"," ('81141', '17422'),\n"," ('805', '3387'),\n"," ('16274', '16275'),\n"," ('13674', '13675'),\n"," ('87008', '88753'),\n"," ('51861', '51862'),\n"," ('51862', '51861'),\n"," ('51903', '51861'),\n"," ('6231', '77468'),\n"," ('84526', '16593'),\n"," ('13987', '6'),\n"," ('4697', '88753'),\n"," ('429', '2785'),\n"," ('82943', '14269'),\n"," ('283', '282'),\n"," ('317', '30389'),\n"," ('30389', '79032'),\n"," ('158', '159'),\n"," ('8068', '52210'),\n"," ('7480', '89635'),\n"," ('45852', '7480'),\n"," ('461', '76482'),\n"," ('3287', '7738'),\n"," ('22513', '22512'),\n"," ('20043', '7049'),\n"," ('67109', '11317'),\n"," ('20873', '80578'),\n"," ('596', '594'),\n"," ('20477', '4963'),\n"," ('10897', '8158'),\n"," ('62343', '544'),\n"," ('16749', '599'),\n"," ('2152', '19323'),\n"," ('13367', '2152'),\n"," ('3334', '81140'),\n"," ('90197', '90196'),\n"," ('11572', '55372'),\n"," ('2815', '88753'),\n"," ('13862', '8948'),\n"," ('21451', '18'),\n"," ('39711', '8724'),\n"," ('12968', '559'),\n"," ('6762', '44382'),\n"," ('44382', '6762'),\n"," ('83478', '83479'),\n"," ('792', '88166'),\n"," ('5404', '2799'),\n"," ('88165', '88166'),\n"," ('91526', '1596'),\n"," ('5821', '88753'),\n"," ('2721', '2522'),\n"," ('5479', '15806'),\n"," ('7401', '7402'),\n"," ('7402', '7401'),\n"," ('3468', '43995'),\n"," ('44406', '28504'),\n"," ('22540', '494'),\n"," ('54', '36982'),\n"," ('307', '73670'),\n"," ('3919', '88753'),\n"," ('819', '75986'),\n"," ('553', '44485'),\n"," ('3719', '44449'),\n"," ('16918', '80256'),\n"," ('89188', '89190'),\n"," ('89189', '89190'),\n"," ('1180', '84953'),\n"," ('84954', '84953'),\n"," ('79298', '14159'),\n"," ('14222', '7965'),\n"," ('10761', '7576'),\n"," ('10481', '7805'),\n"," ('2321', '7250'),\n"," ('38147', '88753'),\n"," ('13819', '65561'),\n"," ('17813', '65561'),\n"," ('65561', '17813'),\n"," ('4897', '88753'),\n"," ('637', '636'),\n"," ('59423', '637'),\n"," ('16252', '16253'),\n"," ('4597', '11372'),\n"," ('10342', '11847'),\n"," ('12516', '12539'),\n"," ('5975', '7330'),\n"," ('8759', '8758'),\n"," ('4065', '4064'),\n"," ('18205', '33'),\n"," ('14179', '14180'),\n"," ('42001', '88753'),\n"," ('19972', '88753'),\n"," ('999', '1325'),\n"," ('5603', '3070'),\n"," ('5261', '11543'),\n"," ('12307', '76468'),\n"," ('13070', '76468'),\n"," ('20778', '81128'),\n"," ('12443', '33'),\n"," ('8791', '54762'),\n"," ('14719', '48638'),\n"," ('7996', '21735'),\n"," ('11262', '27319'),\n"," ('1920', '88753'),\n"," ('13719', '5'),\n"," ('4213', '21633'),\n"," ('2608', '46222'),\n"," ('19598', '13913'),\n"," ('5040', '441'),\n"," ('179', '178'),\n"," ('5029', '5028'),\n"," ('4541', '14595'),\n"," ('2605', '59391'),\n"," ('679', '12207'),\n"," ('1403', '2755'),\n"," ('40542', '5333'),\n"," ('14440', '21904'),\n"," ('20375', '20374'),\n"," ('23587', '61335'),\n"," ('14154', '13993'),\n"," ('19422', '19423'),\n"," ('1549', '68432'),\n"," ('68432', '28766'),\n"," ('3212', '622'),\n"," ('4079', '20515'),\n"," ('10513', '4650'),\n"," ('9980', '22622'),\n"," ('28553', '28557'),\n"," ('28554', '28557'),\n"," ('28556', '28557'),\n"," ('23236', '23235'),\n"," ('77', '6213'),\n"," ('11387', '88753'),\n"," ('11264', '88753'),\n"," ('38550', '93116'),\n"," ('93115', '93116'),\n"," ('67153', '9269'),\n"," ('16466', '10771'),\n"," ('8877', '8878'),\n"," ('2108', '72810'),\n"," ('1009', '1010'),\n"," ('19113', '19114'),\n"," ('4784', '9235'),\n"," ('612', '89511'),\n"," ('8423', '18925'),\n"," ('45440', '8923'),\n"," ('67867', '24931'),\n"," ('46410', '55395'),\n"," ('22587', '32289'),\n"," ('22722', '37016'),\n"," ('48772', '93580'),\n"," ('13282', '21335'),\n"," ('19465', '19464'),\n"," ('11458', '8263'),\n"," ('77883', '77882'),\n"," ('4988', '4989'),\n"," ('4989', '4988'),\n"," ('11952', '65453'),\n"," ('81144', '81143'),\n"," ('53666', '158'),\n"," ('96035', '27934'),\n"," ('4721', '88753'),\n"," ('14562', '14035'),\n"," ('46667', '1009'),\n"," ('6086', '6060'),\n"," ('3772', '68948'),\n"," ('21906', '21904'),\n"," ('20711', '88753'),\n"," ('1812', '8791'),\n"," ('7014', '75351'),\n"," ('14794', '73852'),\n"," ('7406', '19718'),\n"," ('7586', '20193'),\n"," ('20193', '81165'),\n"," ('48941', '88753'),\n"," ('1060', '95009'),\n"," ('51199', '44'),\n"," ('3897', '88753'),\n"," ('14683', '78986'),\n"," ('13996', '88753'),\n"," ('1701', '15868'),\n"," ('2185', '4269'),\n"," ('1369', '15627'),\n"," ('95585', '4255'),\n"," ('13949', '13950'),\n"," ('13950', '13949'),\n"," ('10313', '94814'),\n"," ('2287', '11542'),\n"," ('8805', '7585'),\n"," ('12646', '10201'),\n"," ('7541', '89144'),\n"," ('18091', '1324'),\n"," ('4922', '4921'),\n"," ('13956', '13957'),\n"," ('14120', '2153'),\n"," ('19424', '306'),\n"," ('499', '612'),\n"," ('1249', '79022'),\n"," ('3894', '95948'),\n"," ('645', '88753'),\n"," ('22970', '22969'),\n"," ('721', '94026'),\n"," ('11395', '76069'),\n"," ('3627', '35441'),\n"," ('4570', '8376'),\n"," ('49396', '88753'),\n"," ('2805', '14224'),\n"," ('3083', '61792'),\n"," ('2268', '5705'),\n"," ('36213', '23446'),\n"," ('7055', '7056'),\n"," ('1098', '1096'),\n"," ('8948', '12711'),\n"," ('15012', '88753'),\n"," ('42221', '4564'),\n"," ('26084', '26083'),\n"," ('17559', '61335'),\n"," ('61335', '17559'),\n"," ('11585', '5940'),\n"," ('4236', '4235'),\n"," ('4472', '88753'),\n"," ('987', '58334'),\n"," ('3857', '28761'),\n"," ('485', '349'),\n"," ('67882', '1422'),\n"," ('119', '11239'),\n"," ('6916', '6111'),\n"," ('11239', '8289'),\n"," ('53671', '53670'),\n"," ('3635', '24517'),\n"," ('72824', '72823'),\n"," ('15339', '15340'),\n"," ('53458', '53459'),\n"," ('4141', '4142'),\n"," ('25128', '25129'),\n"," ('13682', '22250'),\n"," ('24955', '2348'),\n"," ('44602', '79368'),\n"," ('1815', '1816'),\n"," ('8256', '8255'),\n"," ('65682', '65683'),\n"," ('868', '11768'),\n"," ('11766', '11768'),\n"," ('11767', '11768'),\n"," ('23034', '53672'),\n"," ('2811', '7405'),\n"," ('58333', '58334'),\n"," ('17449', '93466'),\n"," ('831', '19097'),\n"," ('61896', '438'),\n"," ('14391', '14390'),\n"," ('1678', '810'),\n"," ('19909', '33'),\n"," ('13349', '71238'),\n"," ('3643', '41'),\n"," ('13948', '25760'),\n"," ('15129', '59770'),\n"," ('59770', '15129'),\n"," ('78565', '88753'),\n"," ('52144', '88753'),\n"," ('20742', '61413'),\n"," ('11616', '4664'),\n"," ('84516', '83'),\n"," ('89626', '436'),\n"," ('280', '6982'),\n"," ('52581', '65403'),\n"," ('1555', '538'),\n"," ('4391', '4392'),\n"," ('13579', '306'),\n"," ('51209', '51207'),\n"," ('17446', '1138'),\n"," ('22059', '22058'),\n"," ('6919', '69967'),\n"," ('22182', '22370'),\n"," ('10807', '29076'),\n"," ('89163', '3035'),\n"," ('89165', '89164'),\n"," ('52607', '52608'),\n"," ('6337', '88753'),\n"," ('24851', '2527'),\n"," ('51708', '1171'),\n"," ('6098', '80551'),\n"," ('80550', '80551'),\n"," ('10107', '54502'),\n"," ('2338', '269'),\n"," ('426', '88753'),\n"," ('1820', '1821'),\n"," ('64', '7508'),\n"," ('11994', '32584'),\n"," ('603', '18844'),\n"," ('18844', '603'),\n"," ('7069', '7071'),\n"," ('89132', '89133'),\n"," ('17873', '1147'),\n"," ('95811', '95810'),\n"," ('11018', '68062'),\n"," ('17872', '17871'),\n"," ('30242', '30241'),\n"," ('3895', '88753'),\n"," ('19105', '14362'),\n"," ('26281', '26282'),\n"," ('90118', '90117'),\n"," ('3889', '48945'),\n"," ('972', '59488'),\n"," ('73954', '973'),\n"," ('7640', '18159'),\n"," ('18159', '7640'),\n"," ('1285', '5942'),\n"," ('7753', '7754'),\n"," ('11503', '20834'),\n"," ('16206', '88753'),\n"," ('18589', '4496'),\n"," ('40652', '1379'),\n"," ('28762', '3716'),\n"," ('1762', '441'),\n"," ('3570', '40349'),\n"," ('88331', '88333'),\n"," ('79534', '79532'),\n"," ('10159', '10160'),\n"," ('90738', '4'),\n"," ('1593', '11352'),\n"," ('4923', '24442'),\n"," ('42226', '559'),\n"," ('11433', '1997'),\n"," ('14221', '88753'),\n"," ('14311', '14310'),\n"," ('8775', '554'),\n"," ('90145', '90146'),\n"," ('91380', '44962'),\n"," ('277', '276'),\n"," ('21919', '1073'),\n"," ('11563', '11562'),\n"," ('46328', '88753'),\n"," ('7333', '5766'),\n"," ('3195', '4657'),\n"," ('6197', '38657'),\n"," ('8257', '8255'),\n"," ('13816', '13817'),\n"," ('65559', '26423'),\n"," ('10784', '11036'),\n"," ('10696', '2532'),\n"," ('16058', '22666'),\n"," ('5845', '27405'),\n"," ('2315', '11732'),\n"," ('21784', '21785'),\n"," ('816', '89994'),\n"," ('53732', '53733'),\n"," ('85165', '85163'),\n"," ('14585', '22296'),\n"," ('53011', '53010'),\n"," ('12245', '89135'),\n"," ('95163', '95648'),\n"," ('9281', '8037'),\n"," ('5726', '30132'),\n"," ('24939', '172'),\n"," ('44438', '1531'),\n"," ('5038', '88753'),\n"," ('12607', '6194'),\n"," ('1044', '88753'),\n"," ('3909', '441'),\n"," ('33433', '28537'),\n"," ('2933', '75969'),\n"," ('10692', '2932'),\n"," ('18336', '36973'),\n"," ('72877', '72878'),\n"," ('1628', '8618'),\n"," ('10046', '77105'),\n"," ('44709', '74900'),\n"," ('44710', '44709'),\n"," ('2764', '14723'),\n"," ('243', '8277'),\n"," ('79023', '15130'),\n"," ('2017', '3550'),\n"," ('570', '1141'),\n"," ('87466', '1240'),\n"," ('74896', '74900'),\n"," ('33798', '33799'),\n"," ('20922', '20920'),\n"," ('2214', '6127'),\n"," ('4378', '37016'),\n"," ('26469', '26467'),\n"," ('36982', '54'),\n"," ('3377', '328'),\n"," ('73957', '73956'),\n"," ('50103', '88753'),\n"," ('10906', '10907'),\n"," ('40161', '494'),\n"," ('11116', '12318'),\n"," ('22051', '22050'),\n"," ('21468', '21469'),\n"," ('21470', '21468'),\n"," ('67993', '6194'),\n"," ('42932', '26927'),\n"," ('2442', '85741'),\n"," ('85743', '85741'),\n"," ('85745', '95534'),\n"," ('85746', '85741'),\n"," ('13818', '48752'),\n"," ('30994', '1035'),\n"," ('29052', '29053'),\n"," ('35061', '7585'),\n"," ('81134', '77845'),\n"," ('14908', '14916'),\n"," ('13955', '4'),\n"," ('5067', '94148'),\n"," ('94147', '94148'),\n"," ('94148', '94147'),\n"," ('3645', '40243'),\n"," ('54940', '40144'),\n"," ('14536', '14535'),\n"," ('616', '22683'),\n"," ('25862', '25863'),\n"," ('10318', '11670'),\n"," ('21635', '21636'),\n"," ('22231', '74575'),\n"," ('37667', '79024'),\n"," ('7693', '7692'),\n"," ('4676', '10417'),\n"," ('43412', '7475'),\n"," ('3196', '44804'),\n"," ('4673', '17228'),\n"," ('9068', '21503'),\n"," ('89510', '89511'),\n"," ('1137', '50707'),\n"," ('1547', '1546'),\n"," ('1772', '5424'),\n"," ('53676', '52648'),\n"," ('5391', '3476'),\n"," ('43714', '88753'),\n"," ('6318', '32665'),\n"," ('23525', '54757'),\n"," ('26819', '26818'),\n"," ('3466', '21504'),\n"," ('8093', '8094'),\n"," ('8094', '8093'),\n"," ('7120', '21738'),\n"," ('21738', '21741'),\n"," ('12740', '13057'),\n"," ('37167', '6194'),\n"," ('14069', '14687'),\n"," ('37358', '3952'),\n"," ('87947', '88753'),\n"," ('25131', '20076'),\n"," ('8276', '23666'),\n"," ('9246', '876'),\n"," ('9383', '11749'),\n"," ('939', '248'),\n"," ('3038', '3037'),\n"," ('11323', '11322'),\n"," ('11324', '11322'),\n"," ('2939', '2605'),\n"," ('21972', '27123'),\n"," ('966', '20719'),\n"," ('12026', '40202'),\n"," ('153', '193'),\n"," ('346', '39331'),\n"," ('4718', '7100'),\n"," ('7100', '27281'),\n"," ('2640', '19151'),\n"," ('1826', '71222'),\n"," ('13715', '34472'),\n"," ('38059', '64860'),\n"," ('12608', '39771'),\n"," ('37086', '22182'),\n"," ('1089', '28708'),\n"," ('45228', '306'),\n"," ('21410', '21409'),\n"," ('5326', '88753'),\n"," ('15152', '8844'),\n"," ('26265', '766'),\n"," ('2948', '418'),\n"," ('57623', '57624'),\n"," ('4859', '67244'),\n"," ('68063', '68064'),\n"," ('68064', '68063'),\n"," ('16211', '17339'),\n"," ('11954', '63746'),\n"," ('73331', '73332'),\n"," ('29603', '29602'),\n"," ('2452', '20456'),\n"," ('95108', '95109'),\n"," ('95109', '95108'),\n"," ('32687', '32688'),\n"," ('25244', '9209'),\n"," ('24', '65082'),\n"," ('51692', '51691'),\n"," ('2901', '11066'),\n"," ('16132', '24311'),\n"," ('14046', '88753'),\n"," ('27204', '27205'),\n"," ('77852', '27204'),\n"," ('13707', '13706'),\n"," ('4456', '88753'),\n"," ('56975', '56976'),\n"," ('6429', '36112'),\n"," ('15459', '88753'),\n"," ('4559', '88753'),\n"," ('69037', '88753'),\n"," ('14772', '2786'),\n"," ('330', '329'),\n"," ('2755', '87852'),\n"," ('36612', '14160'),\n"," ('4235', '4236'),\n"," ('67173', '49325'),\n"," ('41252', '41251'),\n"," ('26883', '26882'),\n"," ('78455', '16644'),\n"," ('55870', '4'),\n"," ('246', '52621'),\n"," ('1269', '52619'),\n"," ('52619', '1269'),\n"," ('89143', '6194'),\n"," ('10437', '56896'),\n"," ('7024', '12600'),\n"," ('13192', '11037'),\n"," ('14188', '44731'),\n"," ('11333', '92940'),\n"," ('94200', '94199'),\n"," ('94201', '94199'),\n"," ('56519', '553'),\n"," ('20858', '88753'),\n"," ('55642', '55643'),\n"," ('55643', '55642'),\n"," ('11480', '16704'),\n"," ('7331', '42652'),\n"," ('690', '689'),\n"," ('12626', '95593'),\n"," ('304', '303'),\n"," ...]"]},"execution_count":32,"metadata":{},"output_type":"execute_result"}],"source":["import math #Importo la libreria math para utilizar la raiz cuadrada\n","\n","#Por ultimo lo que hago ahora es buscar las distancias coseno mas grandes para cada compañia y asi obtener la mas similar.\n","#Lo que hago entonces es hacer un reduceByKey donde vamos a operarar por cada registro haciendo la distancia coseno y quedandome con la mayor.\n","moviesCompaniesSimilaresRdd.reduceByKey(lambda a,b: a if((len(a[1][1].intersection(a[0])))/(math.sqrt(len(a[1][1]))*math.sqrt(len(a[0])))>(len(b[1][1].intersection(b[0])))/(math.sqrt(len(b[1][1]))*math.sqrt(len(b[0])))) else b).map(lambda x: (x[0],x[1][1][0])).collect()"]}],"metadata":{"colab":{"collapsed_sections":[],"provenance":[],"authorship_tag":"ABX9TyMcgx3vc5qRmZ3zdgWWNwFq"},"kernelspec":{"display_name":"Python 3","name":"python3"},"language_info":{"name":"python"}},"nbformat":4,"nbformat_minor":0}